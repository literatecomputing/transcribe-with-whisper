#!/usr/bin/env bash
# Start the MercuryScribe web server
set -e

# Get absolute path to project root regardless of invocation location
if command -v realpath >/dev/null 2>&1; then
	SCRIPT_PATH="$(realpath "${BASH_SOURCE[0]}")"
else
	SCRIPT_PATH="$(python3 - <<'PY'
import os, sys
print(os.path.abspath(sys.argv[1]))
PY
"${BASH_SOURCE[0]}")"
fi

SCRIPT_DIR="$(dirname "$SCRIPT_PATH")"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_ROOT"
export PYTHONPATH="$PROJECT_ROOT${PYTHONPATH:+:$PYTHONPATH}"

# Default host and port
HOST="${HOST:-0.0.0.0}"
PORT="${PORT:-5001}"

echo "🚀 Starting MercuryScribe web server..."
echo "📍 Host: $HOST"
echo "🔌 Port: $PORT"
echo "🌐 Open http://localhost:$PORT in your browser"
echo ""
echo "Press Ctrl+C to stop the server"
echo ""

# Start the server
python3 -m transcribe_with_whisper.server_app
